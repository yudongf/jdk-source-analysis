<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.12">
<title>Date</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="assets/css/asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="assets/css/rouge-monokai.css">
<style>p>code{color: #d14 !important;background-color: #f5f5f5 !important;border: 1px solid #e1e1e8;white-space: nowrap;border-radius: 3px;}</style>
</head>
<body class="book">
<div id="header">
<h1><code>Date</code></h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
</pre></td><td class="code"><pre><span class="kn">package</span> <span class="nn">com.diguage.truman</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.commons.lang3.time.FastDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.joda.time.format.DateTimeFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.openjdk.jmh.annotations.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.text.DateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.time.ZoneId</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.time.ZonedDateTime</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.time.format.DateTimeFormatter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">com</span><span class="o">.</span><span class="na">diguage</span><span class="o">.</span><span class="na">truman</span><span class="o">.</span><span class="na">DateFormatTest</span><span class="o">.</span><span class="na">DateFormatUtils</span><span class="o">.</span><span class="na">yyyyMMdd</span><span class="o">;</span>


<span class="nd">@BenchmarkMode</span><span class="o">(</span><span class="nc">Mode</span><span class="o">.</span><span class="na">Throughput</span><span class="o">)</span>
<span class="nd">@Measurement</span><span class="o">(</span><span class="n">iterations</span> <span class="o">=</span> <span class="mi">3</span><span class="o">,</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">5</span><span class="o">,</span> <span class="n">timeUnit</span> <span class="o">=</span> <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">)</span>
<span class="nd">@OutputTimeUnit</span><span class="o">(</span><span class="nc">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">)</span>
<span class="nd">@Warmup</span><span class="o">(</span><span class="n">iterations</span> <span class="o">=</span> <span class="mi">3</span><span class="o">,</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">5</span><span class="o">)</span>
<span class="nd">@Fork</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
<span class="nd">@Threads</span><span class="o">(</span><span class="mi">8</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DateFormatTest</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">DateTimeFormatter</span> <span class="n">formatter</span> <span class="o">=</span> <span class="nc">DateTimeFormatter</span><span class="o">.</span><span class="na">ofPattern</span><span class="o">(</span><span class="n">yyyyMMdd</span><span class="o">);</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">FastDateFormat</span> <span class="n">fastFormat</span> <span class="o">=</span> <span class="nc">FastDateFormat</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">yyyyMMdd</span><span class="o">);</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">org</span><span class="o">.</span><span class="na">joda</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">DateTimeFormatter</span> <span class="n">jodaFormat</span> <span class="o">=</span> <span class="nc">DateTimeFormat</span><span class="o">.</span><span class="na">forPattern</span><span class="o">(</span><span class="n">yyyyMMdd</span><span class="o">);</span>

  <span class="nd">@Benchmark</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">testSimpleDateFormat</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">SimpleDateFormat</span> <span class="n">format</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="n">yyyyMMdd</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">format</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="nd">@Benchmark</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">testLocalSimpleDateFormat</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">DateFormatUtils</span><span class="o">.</span><span class="na">formatDate</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="nd">@Benchmark</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">testVariaFormatter</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">LocalDateTime</span> <span class="n">now</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">now</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="nc">DateTimeFormatter</span><span class="o">.</span><span class="na">ofPattern</span><span class="o">(</span><span class="n">yyyyMMdd</span><span class="o">));</span>
  <span class="o">}</span>

  <span class="nd">@Benchmark</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">testConstFormatter</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">LocalDateTime</span> <span class="n">now</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">now</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">formatter</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Benchmark</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">testConstFormatterDate</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
    <span class="nc">LocalDateTime</span> <span class="n">now</span> <span class="o">=</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">ofInstant</span><span class="o">(</span><span class="n">date</span><span class="o">.</span><span class="na">toInstant</span><span class="o">(),</span> <span class="nc">ZoneId</span><span class="o">.</span><span class="na">systemDefault</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">now</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">formatter</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Benchmark</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">testConstFormatterDateZ</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
    <span class="nc">ZonedDateTime</span> <span class="n">now</span> <span class="o">=</span> <span class="nc">ZonedDateTime</span><span class="o">.</span><span class="na">ofInstant</span><span class="o">(</span><span class="n">date</span><span class="o">.</span><span class="na">toInstant</span><span class="o">(),</span> <span class="nc">ZoneId</span><span class="o">.</span><span class="na">systemDefault</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">now</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">formatter</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Benchmark</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">testVariaFastDateFormat</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">FastDateFormat</span> <span class="n">format</span> <span class="o">=</span> <span class="nc">FastDateFormat</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">yyyyMMdd</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">format</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="nd">@Benchmark</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">testConstFastDateFormat</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">fastFormat</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="nd">@Benchmark</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">testJodaFormat</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">org</span><span class="o">.</span><span class="na">joda</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">LocalDateTime</span> <span class="n">now</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="na">joda</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">LocalDateTime</span><span class="o">.</span><span class="na">fromDateFields</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">jodaFormat</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">now</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">DateFormatUtils</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">yyyyMMdd</span> <span class="o">=</span> <span class="s">"yyyyMMdd"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">ThreadLocal</span><span class="o">&lt;</span><span class="nc">DateFormat</span><span class="o">&gt;</span> <span class="n">dateFormatThreadLocal</span>
      <span class="o">=</span> <span class="nc">ThreadLocal</span><span class="o">.</span><span class="na">withInitial</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="n">yyyyMMdd</span><span class="o">));</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">formatDate</span><span class="o">(</span><span class="nc">Date</span> <span class="n">date</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">dateFormatThreadLocal</span><span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">format</span><span class="o">(</span><span class="n">date</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-12-04 12:05:31 UTC
</div>
</div>
</body>
</html>